<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>프로필 이미지 업로드 - INABOOTH</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" rel="stylesheet">
  <link rel="stylesheet" href="components/shared.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .modal-page {
      padding-top: calc(var(--header-height) + var(--space-8));
      min-height: 100vh;
      padding-bottom: var(--space-8);
      background: var(--color-bg-secondary);
    }

    .modal-card {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--space-8);
      box-shadow: var(--shadow-card);
      max-width: 500px;
      margin: 0 auto;
    }

    .modal-header {
      text-align: center;
      margin-bottom: var(--space-8);
    }

    .modal-header__icon {
      width: 64px;
      height: 64px;
      background: var(--color-primary-light);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-4);
    }

    .modal-header__icon i {
      color: var(--color-primary);
      width: 28px;
      height: 28px;
    }

    .modal-header__title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-2);
    }

    .modal-header__desc {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .upload-area {
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-8);
      text-align: center;
      transition: all var(--transition-fast);
      cursor: pointer;
      margin-bottom: var(--space-6);
    }

    .upload-area:hover {
      border-color: var(--color-primary);
      background: var(--color-primary-light);
    }

    .upload-area.drag-over {
      border-color: var(--color-primary);
      background: var(--color-primary-light);
    }

    .upload-area__icon {
      width: 48px;
      height: 48px;
      background: var(--color-bg-secondary);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-4);
    }

    .upload-area__text {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-2);
    }

    .upload-area__text span {
      color: var(--color-primary);
      font-weight: var(--font-weight-medium);
    }

    .upload-area__hint {
      font-size: var(--font-size-xs);
      color: var(--color-text-tertiary);
    }

    .preview-section {
      display: none;
      margin-bottom: var(--space-6);
    }

    .preview-section.show {
      display: block;
    }

    .preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-4);
    }

    .preview-image {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--color-primary);
    }

    .preview-info {
      text-align: center;
    }

    .preview-info__name {
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-1);
    }

    .preview-info__size {
      font-size: var(--font-size-xs);
      color: var(--color-text-tertiary);
    }

    .preview-actions {
      display: flex;
      gap: var(--space-2);
    }

    .modal-actions {
      display: flex;
      gap: var(--space-3);
    }

    .modal-actions .btn {
      flex: 1;
    }

    .input-file {
      display: none;
    }
  </style>
</head>
<body>
  <div id="header-placeholder"></div>

  <main class="modal-page">
    <div class="container">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-header__icon">
            <i data-lucide="camera"></i>
          </div>
          <h1 class="modal-header__title">프로필 이미지 변경</h1>
          <p class="modal-header__desc">새로운 프로필 이미지를 업로드해주세요.</p>
        </div>

        <!-- 업로드 영역 -->
        <div class="upload-area" id="uploadArea">
          <div class="upload-area__icon">
            <i data-lucide="upload" class="icon"></i>
          </div>
          <p class="upload-area__text">
            <span>클릭하여 업로드</span> 또는 드래그 앤 드롭
          </p>
          <p class="upload-area__hint">PNG, JPG, GIF 최대 5MB</p>
          <input type="file" class="input-file" id="fileInput" accept="image/*">
        </div>

        <!-- 미리보기 영역 -->
        <div class="preview-section" id="previewSection">
          <div class="preview-container">
            <img src="" alt="프로필 미리보기" class="preview-image" id="previewImage">
            <div class="preview-info">
              <div class="preview-info__name" id="fileName">파일명.jpg</div>
              <div class="preview-info__size" id="fileSize">1.2 MB</div>
            </div>
            <div class="preview-actions">
              <button class="btn btn--outline btn--sm" id="changeBtn">
                <i data-lucide="refresh-cw" class="icon icon-sm"></i>
                다른 이미지
              </button>
              <button class="btn btn--ghost btn--sm" id="removeBtn">
                <i data-lucide="trash-2" class="icon icon-sm"></i>
                삭제
              </button>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <a href="9-1 프로필 관리.html" class="btn btn--secondary">취소</a>
          <button class="btn btn--primary" id="saveBtn" onclick="saveProfileImage()">
            <i data-lucide="check" class="icon icon-sm"></i>
            저장하기
          </button>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>
  <script src="components/shared.js"></script>
  <script>
    initPage({activePage:'mypage', isLoggedIn: true});
    lucide.createIcons();

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const previewSection = document.getElementById('previewSection');
    const previewImage = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const changeBtn = document.getElementById('changeBtn');
    const removeBtn = document.getElementById('removeBtn');

    // 클릭으로 파일 선택
    uploadArea.addEventListener('click', () => fileInput.click());

    // 파일 선택 시
    fileInput.addEventListener('change', handleFile);

    // 드래그 앤 드롭
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        showPreview(file);
      }
    });

    // 다른 이미지 버튼
    changeBtn.addEventListener('click', () => fileInput.click());

    // 삭제 버튼
    removeBtn.addEventListener('click', () => {
      fileInput.value = '';
      previewSection.classList.remove('show');
      uploadArea.style.display = 'block';
    });

    function handleFile() {
      const file = fileInput.files[0];
      if (file) {
        showPreview(file);
      }
    }

    function showPreview(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        uploadArea.style.display = 'none';
        previewSection.classList.add('show');
        lucide.createIcons();
      };
      reader.readAsDataURL(file);
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function saveProfileImage() {
      if (!previewSection.classList.contains('show')) {
        Toast.warning('이미지를 선택해주세요.');
        return;
      }
      Toast.success('프로필 이미지가 변경되었습니다.');
      setTimeout(() => {
        window.location.href = '9-1 프로필 관리.html';
      }, 1500);
    }
  </script>
</body>
</html>
